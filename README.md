- [Библиотека форматирования marty::format](#user-content-библиотека-форматирования-martyformat)
  - [Синтаксис форматной строки](#user-content-синтаксис-форматной-строки)
    - [Преобразование типа аргумента](#user-content-преобразование-типа-аргумента)
    - [Спецификатор формата](#user-content-спецификатор-формата)

# Библиотека форматирования marty::format

## Синтаксис форматной строки



Форматная строка содержит "поля замены", окруженные фигурными скобками (`{}`).
Все, что не заключено в фигурные скобки, считается текстом, который копируется в вывод без изменений.
Если вам нужно включить символ скобки в текст, его можно экранировать удвоением: `{{` и `}}`.

**Примечание**. В зависимости от режима игнорирования ошибок, закрывающая фигурная скобка может быть
единственной.


Грамматика для полей замены выглядит так:

<pre>
replacement_field ::= &quot;{&quot; [arg_id] [&quot;!&quot; conversion] [&quot;:&quot; format_spec] &quot;}&quot;
arg_id            ::= arg_index | arg_name
arg_index         ::= digit+
arg_name          ::= identifier
conversion        ::= &quot;r&quot; | &quot;s&quot; | &quot;a&quot;
format_spec       ::= format_spec_expr
</pre>

<!-- -->

**arg_id** - идентификатор аргумента. Может отсутствовать, тогда используется автоматически 
подставляемый индекс, который инкрементируется при появлении каждого "поля замены" с отсутствующим 
идентификатором аргумента.

**arg_index** - индекс аргумента, начиная с нуля. Для ассоциативных контейнеров 
типа `std::map` и `std::unordered_map` обращение по индексу производится с использованием 
`std::advance`. Индекс аргумента должен быть корректным десятичным числом.

**arg_name** - имя аргумента, допустимы любые символы, кроме символов `:`, `{` и `}`.
В зависимости от типа контейнера, в котором передаются аргументы, именованное обращение к аргументам
может не поддерживаться. Так, для контейнеров типа `std::vector` или `std::initializer_list`
использование именованного аргумента приведёт к выбросу исключения, если это не запрещено режимом 
игнорирования ошибок.

**conversion** - преобразование типа аргумента, см. далее "Преобразование типа аргумента".

**format_spec** - спецификатор формата, см. далее.

**Примечание**. При использовании ассоциативных контейнеров типа `std::map` и `std::unordered_map`
не существует возможности задать порядок следования аргументов, порядок следования аргументов определяется
контейнером. При использовании контейнеров типа `std::vector` или `std::initializer_list` нет возможности
использовать именованные аргументы. Для возможности использования одновременно обращений к аргументам 
по целочисленному индексу и по имени аргумента следует использовать конейнер `std::vector` с элементами
типа `std::pair<std::string, T>` (вместо `std::pair` можно использовать любую другую структуру, которая имеет
вложенные типы `first_type` и `second_type`, и, соответственно, поля `first` и `second`), либо
`marty::format::BaseArgs<...>`, специфицированный пользовательскими типами или явно специфицированный `marty::format::Args`.


### Преобразование типа аргумента

В данный момент не реализовано, планируется к реализации. Использование в поле замены вызовет ошибку.
Надо разобраться, что делают режимы преобразования в оригинальной реализации форматирования в `python`,
и продумать, что они будут делать в данной библиотеке.

`s` - преобразует аргумент в строку (см. описание [str](https://docs.python.org/3/library/stdtypes.html#str)).

`r` - преобразует аргумент в строку (см. описание [repr](https://docs.python.org/3/library/functions.html#repr)).

`a` - преобразует аргумент в строку (см. описание [ascii](https://docs.python.org/3/library/functions.html#ascii)).


### Спецификатор формата


<pre>
format_spec ::= [options][width][grouping][&quot;.&quot; precision][type]
options     ::= [[fill]align][sign][&quot;z&quot;][&quot;#&quot;][&quot;0&quot;]
fill        ::= &lt;any character&gt;
align       ::= &quot;&lt;&quot; | &quot;&gt;&quot; | &quot;=&quot; | &quot;^&quot;
sign        ::= &quot;+&quot; | &quot;-&quot; | &quot; &quot;
width       ::= digit+
grouping    ::= &quot;,&quot; | &quot;_&quot; | &quot;&apos;&quot;
precision   ::= digit+
type        ::= &quot;b&quot; | &quot;c&quot; | &quot;d&quot; | &quot;e&quot; | &quot;E&quot; | &quot;f&quot; | &quot;F&quot; | &quot;g&quot; | &quot;G&quot; | &quot;n&quot; | &quot;o&quot; | &quot;s&quot; | &quot;x&quot; | &quot;X&quot; | &quot;%&quot;
</pre>

<!-- -->

**fill**, **align** - заполнение и выравнивание, см. далее.

|Символ выравнивания|Значение|
|:-|:-|
|`<`||
|`>`||
|`=`||
|`^`||


**sign** - знак

**width** - ширина поля

**grouping** - символ группировки

**precision** - точость

**type** - спецификатор типа.



format_spec ::= [options][width][grouping]["." precision][type]
options     ::= [[fill]align][sign]["z"]["#"]["0"]
fill        ::= <any character>
align       ::= "<" | ">" | "=" | "^"
sign        ::= "+" | "-" | " "
width       ::= digit+
grouping    ::= "," | "_" | "'"
precision   ::= digit+
type        ::= "b" | "c" | "d" | "e" | "E" | "f" | "F" | "g" | "G" | "n" | "o" | "s" | "x" | "X" | "%"







